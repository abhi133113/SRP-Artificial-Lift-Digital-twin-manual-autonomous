<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRP Autonomous Twin | Analytics</title>
    <link rel="stylesheet" href="static/style.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Mono:wght@400;700&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --gradient-cyan: linear-gradient(135deg, #00f2ff 0%, #0066ff 100%);
            --gradient-pink: linear-gradient(135deg, #ff0055 0%, #ff6b35 100%);
            --gradient-green: linear-gradient(135deg, #00ff88 0%, #00cc6a 100%);
            --gradient-purple: linear-gradient(135deg, #a855f7 0%, #6366f1 100%);
            --gradient-orange: linear-gradient(135deg, #f97316 0%, #eab308 100%);
        }

        .analytics-container {
            display: flex;
            flex-direction: column;
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            gap: 16px;
        }

        /* Stats Row */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
        }

        .stat-card {
            background: var(--bg-panel);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 16px;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
        }

        .stat-card.cyan::before {
            background: var(--gradient-cyan);
        }

        .stat-card.pink::before {
            background: var(--gradient-pink);
        }

        .stat-card.green::before {
            background: var(--gradient-green);
        }

        .stat-card.purple::before {
            background: var(--gradient-purple);
        }

        .stat-card.orange::before {
            background: var(--gradient-orange);
        }

        .stat-card .label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 6px;
        }

        .stat-card .value {
            font-family: 'Roboto Mono', monospace;
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .stat-card.cyan .value {
            color: #00f2ff;
        }

        .stat-card.pink .value {
            color: #ff0055;
        }

        .stat-card.green .value {
            color: #00ff88;
        }

        .stat-card.purple .value {
            color: #a855f7;
        }

        .stat-card.orange .value {
            color: #f97316;
        }

        .stat-card .trend {
            font-size: 0.75rem;
            margin-top: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .stat-card .trend.up {
            color: #00ff88;
        }

        .stat-card .trend.down {
            color: #ff0055;
        }

        /* Charts Grid */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            flex: 1;
        }

        .chart-card {
            background: var(--bg-panel);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 16px;
            display: flex;
            flex-direction: column;
        }

        .chart-card.full-width {
            grid-column: span 2;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .chart-header h3 {
            font-size: 0.85rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 0;
        }

        .chart-header h3 .icon {
            font-size: 1.1rem;
        }

        .chart-header .badge {
            background: rgba(0, 242, 255, 0.15);
            color: var(--neon-cyan);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-family: 'Roboto Mono', monospace;
            font-weight: 600;
        }

        .chart-header .badge.warning {
            background: rgba(255, 0, 85, 0.15);
            color: #ff0055;
        }

        .chart-header .badge.success {
            background: rgba(0, 255, 136, 0.15);
            color: #00ff88;
        }

        .chart-container {
            flex: 1;
            position: relative;
            min-height: 180px;
        }

        /* Mini Charts in Stats */
        .mini-chart {
            height: 40px;
            margin-top: 8px;
        }

        /* Efficiency Gauge */
        .gauge-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex: 1;
        }

        .gauge {
            position: relative;
            width: 160px;
            height: 160px;
        }

        .gauge-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .gauge-value .number {
            font-family: 'Roboto Mono', monospace;
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .gauge-value .unit {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        /* Status Indicators */
        .status-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 12px;
        }

        .status-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .status-item .icon {
            font-size: 1.5rem;
            margin-bottom: 6px;
        }

        .status-item .label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .status-item .value {
            font-family: 'Roboto Mono', monospace;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-top: 4px;
        }

        /* Animation */
        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(0, 255, 136, 0.1);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.7rem;
            color: #00ff88;
        }

        .live-indicator::before {
            content: '';
            width: 6px;
            height: 6px;
            background: #00ff88;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .stats-row {
                grid-template-columns: repeat(3, 1fr);
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .chart-card.full-width {
                grid-column: span 1;
            }
        }

        @media (max-width: 768px) {
            .stats-row {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>

<body>
    <div class="app-container">
        <!-- SIDEBAR -->
        <div class="sidebar" id="sidebar">
            <button class="toggle-btn" id="sidebarToggle">‚ò∞</button>
            <nav class="nav-links">
                <a href="/" class="nav-item">
                    <span class="icon">üìä</span>
                    <span class="text">Dashboard</span>
                </a>
                <a href="/deadlines.html" class="nav-item">
                    <span class="icon">‚è≥</span>
                    <span class="text">Maintenance</span>
                </a>
                <a href="/analytics.html" class="nav-item active">
                    <span class="icon">üìà</span>
                    <span class="text">Analytics</span>
                </a>
            </nav>
        </div>

        <!-- HEADER -->
        <header class="header">
            <div class="header-left">
                <div class="status-indicator online"></div>
                <h1>Performance Analytics</h1>
                <span class="live-indicator">LIVE</span>
            </div>
            <div class="header-right">
                <span style="color: var(--text-secondary); font-size: 0.8rem; margin-right: 16px;" id="lastUpdate">Last
                    Update: --:--:--</span>
                <a href="/" class="briefing-btn">
                    <span class="icon">‚Üê</span> Dashboard
                </a>
            </div>
        </header>

        <!-- ANALYTICS CONTENT -->
        <main class="analytics-container">

            <!-- STATS ROW -->
            <div class="stats-row">
                <div class="stat-card cyan">
                    <span class="label">Current Fillage</span>
                    <span class="value" id="statFillage">--%</span>
                    <span class="trend up" id="trendFillage">‚Üë Optimal</span>
                </div>
                <div class="stat-card pink">
                    <span class="label">Rod Stress</span>
                    <span class="value" id="statStress">--%</span>
                    <span class="trend down" id="trendStress">‚Üì Safe Zone</span>
                </div>
                <div class="stat-card green">
                    <span class="label">Pump Speed</span>
                    <span class="value" id="statSPM">-- SPM</span>
                    <span class="trend up" id="trendSPM">‚Üë Controlled</span>
                </div>
                <div class="stat-card purple">
                    <span class="label">Efficiency Score</span>
                    <span class="value" id="statEfficiency">--%</span>
                    <span class="trend up">‚Üë Above Target</span>
                </div>
                <div class="stat-card orange">
                    <span class="label">Data Points</span>
                    <span class="value" id="statDataPoints">0</span>
                    <span class="trend">Last 100 readings</span>
                </div>
            </div>

            <!-- CHARTS GRID -->
            <div class="charts-grid">

                <!-- Fillage History (Large) -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h3><span class="icon">üåä</span> Pump Fillage Trend</h3>
                        <span class="badge success" id="fillageStatus">OPTIMAL</span>
                    </div>
                    <div class="chart-container">
                        <canvas id="fillageChart"></canvas>
                    </div>
                </div>

                <!-- Stress History -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h3><span class="icon">‚öôÔ∏è</span> Rod Stress Analysis</h3>
                        <span class="badge" id="stressStatus">SAFE</span>
                    </div>
                    <div class="chart-container">
                        <canvas id="stressChart"></canvas>
                    </div>
                </div>

                <!-- SPM Control -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h3><span class="icon">‚ö°</span> SPM Control History</h3>
                        <span class="badge success">AUTONOMOUS</span>
                    </div>
                    <div class="chart-container">
                        <canvas id="spmChart"></canvas>
                    </div>
                </div>

                <!-- Combined Efficiency -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h3><span class="icon">üìä</span> System Efficiency</h3>
                        <span class="badge success" id="efficiencyBadge">EXCELLENT</span>
                    </div>
                    <div class="gauge-container">
                        <div class="gauge">
                            <canvas id="efficiencyGauge"></canvas>
                            <div class="gauge-value">
                                <div class="number" id="gaugeValue">--</div>
                                <div class="unit">Efficiency</div>
                            </div>
                        </div>
                    </div>
                    <div class="status-grid">
                        <div class="status-item">
                            <div class="icon">üîã</div>
                            <div class="label">Energy Saved</div>
                            <div class="value" id="energySaved">-- kWh</div>
                        </div>
                        <div class="status-item">
                            <div class="icon">üõ°Ô∏è</div>
                            <div class="label">Strokes Saved</div>
                            <div class="value" id="strokesSaved">--</div>
                        </div>
                        <div class="status-item">
                            <div class="icon">‚è±Ô∏è</div>
                            <div class="label">Uptime</div>
                            <div class="value" id="uptime">99.9%</div>
                        </div>
                    </div>
                </div>

                <!-- Multi-Metric Chart (Full Width) -->
                <div class="chart-card full-width">
                    <div class="chart-header">
                        <h3><span class="icon">üìà</span> Combined Performance Metrics</h3>
                        <span class="badge">ALL PARAMETERS</span>
                    </div>
                    <div class="chart-container" style="min-height: 220px;">
                        <canvas id="combinedChart"></canvas>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <script>
        // Sidebar Toggle
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebarToggle');
        if (sidebarToggle) {
            sidebarToggle.addEventListener('click', () => {
                sidebar.classList.toggle('active');
                sidebarToggle.textContent = sidebar.classList.contains('active') ? '√ó' : '‚ò∞';
            });
        }

        // Chart instances
        let fillageChart, stressChart, spmChart, combinedChart, efficiencyGauge;

        function initCharts() {
            Chart.defaults.color = '#94a3b8';
            Chart.defaults.borderColor = 'rgba(255, 255, 255, 0.06)';
            Chart.defaults.font.family = "'Inter', sans-serif";

            // Fillage Chart
            const ctxFillage = document.getElementById('fillageChart').getContext('2d');
            const gradFillage = ctxFillage.createLinearGradient(0, 0, 0, 200);
            gradFillage.addColorStop(0, 'rgba(0, 242, 255, 0.4)');
            gradFillage.addColorStop(1, 'rgba(0, 242, 255, 0.0)');

            fillageChart = new Chart(ctxFillage, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Fillage %',
                        data: [],
                        borderColor: '#00f2ff',
                        backgroundColor: gradFillage,
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 5,
                        pointHoverBackgroundColor: '#00f2ff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { min: 0, max: 100, grid: { color: 'rgba(255,255,255,0.04)' } },
                        x: { display: false }
                    },
                    interaction: { mode: 'index', intersect: false }
                }
            });

            // Stress Chart
            const ctxStress = document.getElementById('stressChart').getContext('2d');
            const gradStress = ctxStress.createLinearGradient(0, 0, 0, 200);
            gradStress.addColorStop(0, 'rgba(255, 0, 85, 0.4)');
            gradStress.addColorStop(1, 'rgba(255, 0, 85, 0.0)');

            stressChart = new Chart(ctxStress, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Stress %',
                        data: [],
                        borderColor: '#ff0055',
                        backgroundColor: gradStress,
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 5,
                        pointHoverBackgroundColor: '#ff0055'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { min: 0, max: 120, grid: { color: 'rgba(255,255,255,0.04)' } },
                        x: { display: false }
                    },
                    interaction: { mode: 'index', intersect: false }
                }
            });

            // SPM Chart
            const ctxSPM = document.getElementById('spmChart').getContext('2d');
            const gradSPM = ctxSPM.createLinearGradient(0, 0, 0, 200);
            gradSPM.addColorStop(0, 'rgba(0, 255, 136, 0.3)');
            gradSPM.addColorStop(1, 'rgba(0, 255, 136, 0.0)');

            spmChart = new Chart(ctxSPM, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'SPM',
                        data: [],
                        borderColor: '#00ff88',
                        backgroundColor: gradSPM,
                        borderWidth: 2,
                        fill: true,
                        stepped: true,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { min: 0, max: 10, grid: { color: 'rgba(255,255,255,0.04)' } },
                        x: { display: false }
                    }
                }
            });

            // Combined Chart
            const ctxCombined = document.getElementById('combinedChart').getContext('2d');
            combinedChart = new Chart(ctxCombined, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Fillage %',
                            data: [],
                            borderColor: '#00f2ff',
                            borderWidth: 2,
                            tension: 0.4,
                            pointRadius: 0,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Stress %',
                            data: [],
                            borderColor: '#ff0055',
                            borderWidth: 2,
                            tension: 0.4,
                            pointRadius: 0,
                            yAxisID: 'y'
                        },
                        {
                            label: 'SPM',
                            data: [],
                            borderColor: '#00ff88',
                            borderWidth: 2,
                            stepped: true,
                            pointRadius: 0,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: { usePointStyle: true, padding: 20 }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            position: 'left',
                            min: 0,
                            max: 120,
                            grid: { color: 'rgba(255,255,255,0.04)' },
                            title: { display: true, text: '%' }
                        },
                        y1: {
                            type: 'linear',
                            position: 'right',
                            min: 0,
                            max: 10,
                            grid: { drawOnChartArea: false },
                            title: { display: true, text: 'SPM' }
                        },
                        x: { display: true, grid: { color: 'rgba(255,255,255,0.02)' } }
                    },
                    interaction: { mode: 'index', intersect: false }
                }
            });

            // Efficiency Gauge
            const ctxGauge = document.getElementById('efficiencyGauge').getContext('2d');
            efficiencyGauge = new Chart(ctxGauge, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [0, 100],
                        backgroundColor: ['#00ff88', 'rgba(255,255,255,0.05)'],
                        borderWidth: 0,
                        cutout: '75%'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: { legend: { display: false }, tooltip: { enabled: false } },
                    rotation: -90,
                    circumference: 180
                }
            });
        }

        async function updateCharts() {
            try {
                const response = await fetch('/api/history');
                const data = await response.json();

                if (data.length > 0) {
                    const labels = data.map(d => d.timestamp);
                    const fillageData = data.map(d => d.fillage);
                    const stressData = data.map(d => d.stress);
                    const spmData = data.map(d => d.spm);

                    const latestFillage = fillageData[fillageData.length - 1];
                    const latestStress = stressData[stressData.length - 1];
                    const latestSPM = spmData[spmData.length - 1];

                    // Update stats
                    document.getElementById('statFillage').textContent = latestFillage + '%';
                    document.getElementById('statStress').textContent = latestStress.toFixed(1) + '%';
                    document.getElementById('statSPM').textContent = latestSPM.toFixed(1) + ' SPM';
                    document.getElementById('statDataPoints').textContent = data.length;

                    // Calculate efficiency
                    const efficiency = Math.min(100, Math.max(0, (latestFillage / 100) * 80 + (1 - latestStress / 100) * 20));
                    document.getElementById('statEfficiency').textContent = efficiency.toFixed(0) + '%';
                    document.getElementById('gaugeValue').textContent = efficiency.toFixed(0) + '%';

                    // Update gauge
                    efficiencyGauge.data.datasets[0].data = [efficiency, 100 - efficiency];
                    efficiencyGauge.update();

                    // Update status badges
                    document.getElementById('fillageStatus').textContent = latestFillage > 80 ? 'OPTIMAL' : latestFillage > 60 ? 'WARNING' : 'CRITICAL';
                    document.getElementById('fillageStatus').className = 'badge ' + (latestFillage > 80 ? 'success' : latestFillage > 60 ? 'warning' : 'warning');

                    document.getElementById('stressStatus').textContent = latestStress < 70 ? 'SAFE' : latestStress < 90 ? 'WARNING' : 'DANGER';
                    document.getElementById('stressStatus').className = 'badge ' + (latestStress < 70 ? 'success' : 'warning');

                    // Update trends
                    if (fillageData.length >= 2) {
                        const fillTrend = latestFillage - fillageData[fillageData.length - 2];
                        document.getElementById('trendFillage').textContent = (fillTrend >= 0 ? '‚Üë' : '‚Üì') + ' ' + (latestFillage > 80 ? 'Optimal' : 'Low');
                        document.getElementById('trendFillage').className = 'trend ' + (fillTrend >= 0 ? 'up' : 'down');
                    }

                    // Update charts
                    fillageChart.data.labels = labels;
                    fillageChart.data.datasets[0].data = fillageData;
                    fillageChart.update('none');

                    stressChart.data.labels = labels;
                    stressChart.data.datasets[0].data = stressData;
                    stressChart.update('none');

                    spmChart.data.labels = labels;
                    spmChart.data.datasets[0].data = spmData;
                    spmChart.update('none');

                    combinedChart.data.labels = labels;
                    combinedChart.data.datasets[0].data = fillageData;
                    combinedChart.data.datasets[1].data = stressData;
                    combinedChart.data.datasets[2].data = spmData;
                    combinedChart.update('none');

                    // Update timestamp
                    document.getElementById('lastUpdate').textContent = 'Last Update: ' + labels[labels.length - 1];

                    // Update efficiency badge
                    document.getElementById('efficiencyBadge').textContent = efficiency > 85 ? 'EXCELLENT' : efficiency > 70 ? 'GOOD' : 'NEEDS ATTENTION';
                    document.getElementById('efficiencyBadge').className = 'badge ' + (efficiency > 85 ? 'success' : efficiency > 70 ? '' : 'warning');
                }
            } catch (e) {
                console.error('Error fetching history:', e);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            initCharts();
            updateCharts();
            setInterval(updateCharts, 2000);
        });
    </script>
</body>

</html>